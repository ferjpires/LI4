@page "/admin"
@using Microsoft.AspNetCore.Components.Authorization
@inject AuthenticationStateProvider AuthProvider

<h3>Admin Page</h3>

@code {
    private AuthenticationState? authState;
    private bool isAuthenticated = false;
    private string? userName;
    private string? userRole;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            authState = await AuthProvider.GetAuthenticationStateAsync();
            var user = authState.User;

            if (user.Identity is not null && user.Identity.IsAuthenticated)
            {
                isAuthenticated = true;
                userName = user.Identity.Name;
                userRole = user.Claims.FirstOrDefault(c => c.Type == System.Security.Claims.ClaimTypes.Role)?.Value;
            }

            StateHasChanged(); // Atualiza a interface
        }
    }
}

@if (isAuthenticated)
{
    <p>Bem-vindo, <b>@userName</b>! A tua role é: <b>@userRole</b>.</p>
}
else
{
    <p>Não estás autenticado. Por favor, faz login para aceder a esta página.</p>
}
